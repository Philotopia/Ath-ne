<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AthÃ¨nes â€” Guide Ultime</title>

  <!-- React & ReactDOM -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <!-- Babel for JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: { colors: { stone: { 850: '#1c1917', 900: '#0c0a09' } } }
      }
    }
  </script>

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Lato:wght@300;400;700&display=swap');
    body { font-family: 'Lato', sans-serif; transition: background-color .25s, color .25s; }
    h1, h2, h3, .serif-title { font-family: 'Cinzel', serif; }

    #map-container { height: 520px; width: 100%; border-radius: .75rem; }
    @keyframes fadeIn { from {opacity:0; transform: translateY(6px)} to {opacity:1; transform: translateY(0)} }
    .animate-fade-in { animation: fadeIn .24s ease both; }

    ::-webkit-scrollbar { width: 8px; height: 8px; }
    ::-webkit-scrollbar-track { background: #f1f1f1; }
    ::-webkit-scrollbar-thumb { background: #888; border-radius: 4px; }
    .dark ::-webkit-scrollbar-track { background: #2d2d2d; }
    .dark ::-webkit-scrollbar-thumb { background: #555; }

    .img-skeleton {
      background: linear-gradient(90deg, rgba(0,0,0,0.06), rgba(0,0,0,0.12), rgba(0,0,0,0.06));
      background-size: 200% 100%;
      animation: shimmer 1.1s infinite;
    }
    .dark .img-skeleton {
      background: linear-gradient(90deg, rgba(255,255,255,0.06), rgba(255,255,255,0.12), rgba(255,255,255,0.06));
    }
    @keyframes shimmer { 0% { background-position: 200% 0 } 100% { background-position: -200% 0 } }
  </style>
</head>

<body class="bg-[#f4f1ea] text-[#2c2c2c] dark:bg-stone-900 dark:text-stone-200">
  <div id="root"></div>

  <script type="text/babel">
    const { useEffect, useMemo, useState } = React;

    function useLocalStorageState(key, initialValue) {
      const [value, setValue] = useState(() => {
        try { const raw = localStorage.getItem(key); return raw ? JSON.parse(raw) : initialValue; }
        catch { return initialValue; }
      });
      useEffect(() => { try { localStorage.setItem(key, JSON.stringify(value)); } catch {} }, [key, value]);
      return [value, setValue];
    }

    // --- DONNÃ‰ES CULTURELLES (avec titres Wikipedia) ---
    const placesData = [
      // ACROPOLE
      { id: 1,  name: "Acropole d'AthÃ¨nes", zone: "Acropole", color: "red", address: "Athens 105 58", coords: [37.9715, 23.7257],
        hours: "08:00 - 17:00", price: "Hiver: 10â‚¬ | Pass 30â‚¬", booking: "Obligatoire", myth: "Duel AthÃ©na/PosÃ©idon.", philo: "Hybris et Mesure.",
        website: "http://odysseus.culture.gr/h/3/eh351.jsp?obj_id=2384", type: "Primaire",
        wikiTitle: "Acropole_d'AthÃ¨nes",
        activity: "Monter les PropylÃ©es, faire le tour du ParthÃ©non, voir l'Ã‰rechthÃ©ion, vue panoramique."
      },
      { id: 2,  name: "MusÃ©e de l'Acropole", zone: "Acropole", color: "red", address: "Dionysiou Areopagitou 15", coords: [37.9684, 23.7285],
        hours: "Lun-Jeu: 9h-17h | Ven: 22h", price: "Hiver: 5â‚¬", booking: "ConseillÃ©e", myth: "Caryatides.", philo: "MÃ©moire.",
        website: "https://www.theacropolismuseum.gr/en", type: "Primaire",
        wikiTitle: "MusÃ©e_de_l'Acropole",
        activity: "Voir les Caryatides, sols de verre, resto avec vue."
      },
      { id: 3,  name: "Colline de la Pnyx", zone: "Acropole", color: "red", address: "Pnyx", coords: [37.9716, 23.7194],
        hours: "24h/24", price: "Gratuit", booking: "Non", myth: "Zeus Hypsistos.", philo: "DÃ©mocratie.",
        website: "https://fr.wikipedia.org/wiki/Pnyx", type: "Primaire",
        wikiTitle: "Pnyx",
        activity: "Se tenir sur la tribune des orateurs, vue top sur l'Acropole."
      },
      { id: 12, name: "Monument de Philopappos", zone: "Acropole", color: "red", address: "Filopappou Hill", coords: [37.9673, 23.7213],
        hours: "24h/24", price: "Gratuit", booking: "Non", myth: "Muses.", philo: "Vue panoramique.",
        website: "https://fr.wikipedia.org/wiki/Monument_de_Philopappos", type: "Secondaire",
        wikiTitle: "Monument_de_Philopappos",
        activity: "Balade facile et coucher de soleil."
      },
      { id: 13, name: "OdÃ©on d'HÃ©rode Atticus", zone: "Acropole", color: "red", address: "Dionysiou Areopagitou", coords: [37.9708, 23.7246],
        hours: "Visible de l'extÃ©rieur", price: "-", booking: "Spectacles uniquement", myth: "Dionysos.", philo: "Musique & TragÃ©die.",
        website: "https://fr.wikipedia.org/wiki/OdÃ©on_d'HÃ©rode_Atticus", type: "Secondaire",
        wikiTitle: "OdÃ©on_d'HÃ©rode_Atticus",
        activity: "Admirer depuis le chemin piÃ©tonnier."
      },

      // AGORA
      { id: 4,  name: "Agora Antique", zone: "Agora", color: "blue", address: "Adrianou 24", coords: [37.9750, 23.7225],
        hours: "08:00 - 17:00", price: "Hiver: 5â‚¬ | Pass 30â‚¬", booking: "Non", myth: "HÃ©phaÃ¯stos.", philo: "Socrate.",
        website: "https://fr.wikipedia.org/wiki/Agora_d'AthÃ¨nes", type: "Primaire",
        wikiTitle: "Agora_d'AthÃ¨nes",
        activity: "Temple d'HÃ©phaÃ¯stos, Stoa d'Attale, ambiance civique."
      },
      { id: 5,  name: "BibliothÃ¨que d'Hadrien", zone: "Agora", color: "blue", address: "Areos 3", coords: [37.9756, 23.7262],
        hours: "08:00 - 17:00", price: "Hiver: 3â‚¬ | Pass 30â‚¬", booking: "Non", myth: "Romain.", philo: "Savoir.",
        website: "https://fr.wikipedia.org/wiki/BibliothÃ¨que_d'Hadrien", type: "Primaire",
        wikiTitle: "BibliothÃ¨que_d'Hadrien",
        activity: "Vestiges romains et couches byzantines."
      },
      { id: 6,  name: "Kerameikos", zone: "Agora", color: "blue", address: "Ermou 148", coords: [37.9783, 23.7179],
        hours: "08:00 - 17:00", price: "Hiver: 4â‚¬ | Pass 30â‚¬", booking: "Non", myth: "Enfers.", philo: "Mort.",
        website: "https://fr.wikipedia.org/wiki/KÃ©ramique_(AthÃ¨nes)", type: "Primaire",
        wikiTitle: "KÃ©ramique_(AthÃ¨nes)",
        activity: "AllÃ©e des tombes + petit musÃ©e."
      },
      { id: 14, name: "Temple de Zeus (Olympieion)", zone: "Agora", color: "blue", address: "Athens 105 57", coords: [37.9693, 23.7331],
        hours: "08:00 - 17:00", price: "Hiver: 3â‚¬ | Pass 30â‚¬", booking: "Non", myth: "Zeus.", philo: "Grandeur & DÃ©clin.",
        website: "https://fr.wikipedia.org/wiki/Temple_de_Zeus_Olympien", type: "Secondaire",
        wikiTitle: "Temple_de_Zeus_Olympien",
        activity: "Colonnes monumentales + Porte d'Hadrien."
      },
      { id: 15, name: "Jardin National", zone: "Agora", color: "blue", address: "Leoforos Amalias 1", coords: [37.9730, 23.7369],
        hours: "Lever au Coucher", price: "Gratuit", booking: "Non", myth: "Reine Amalia.", philo: "Botanique.",
        website: "https://fr.wikipedia.org/wiki/Jardin_national_d'AthÃ¨nes", type: "Secondaire",
        wikiTitle: "Jardin_national_d'AthÃ¨nes",
        activity: "Balade, tortues, pause lecture."
      },

      // PHILOSOPHIE
      { id: 7,  name: "LycÃ©e d'Aristote", zone: "Philosophie", color: "purple", address: "Rigillis 11", coords: [37.9738, 23.7443],
        hours: "08:00 - 17:00", price: "Hiver: 2â‚¬ | Pass 30â‚¬", booking: "Non", myth: "Apollon.", philo: "Logique.",
        website: "https://fr.wikipedia.org/wiki/LycÃ©e_d'Aristote", type: "Primaire",
        wikiTitle: "LycÃ©e_d'Aristote",
        activity: "Lire un extrait sur place, ambiance calme."
      },
      { id: 9,  name: "MusÃ©e ArchÃ©ologique", zone: "Philosophie", color: "purple", address: "28is Oktovriou 44", coords: [37.9891, 23.7326],
        hours: "08:30 - 15:30", price: "Hiver: 6â‚¬", booking: "Non", myth: "MycÃ¨nes.", philo: "Art.",
        website: "https://fr.wikipedia.org/wiki/MusÃ©e_national_archÃ©ologique_d'AthÃ¨nes", type: "Primaire",
        wikiTitle: "MusÃ©e_national_archÃ©ologique_d'AthÃ¨nes",
        activity: "Masque d'Agamemnon, AnticythÃ¨re, statuaire."
      },
      { id: 16, name: "Stade PanathÃ©naÃ¯que", zone: "Philosophie", color: "purple", address: "Leof. Vasileos Konstantinou", coords: [37.9686, 23.7408],
        hours: "08:00 - 17:00", price: "10â‚¬", booking: "Non", myth: "AthÃ©na (Jeux).", philo: "Agon.",
        website: "https://fr.wikipedia.org/wiki/Stade_panathÃ©naÃ¯que", type: "Secondaire",
        wikiTitle: "Stade_panathÃ©naÃ¯que",
        activity: "Monter en haut des gradins, tunnel, photo."
      },
      { id: 17, name: "MusÃ©e Benaki", zone: "Philosophie", color: "purple", address: "Koumpari 1", coords: [37.9760, 23.7403],
        hours: "10:00 - 18:00 (FermÃ© Mar)", price: "12â‚¬", booking: "Non", myth: "Histoire Grecque.", philo: "IdentitÃ©.",
        website: "https://fr.wikipedia.org/wiki/MusÃ©e_Benaki", type: "Secondaire",
        wikiTitle: "MusÃ©e_Benaki",
        activity: "Histoire grecque + cafÃ© terrasse."
      },
      { id: 18, name: "MusÃ©e Art Cycladique", zone: "Philosophie", color: "purple", address: "Neofitou Douka 4", coords: [37.9757, 23.7424],
        hours: "10:00 - 17:00 (FermÃ© Mar)", price: "12â‚¬", booking: "Non", myth: "Cyclades.", philo: "Abstraction.",
        website: "https://fr.wikipedia.org/wiki/MusÃ©e_d%27art_cycladique", type: "Secondaire",
        wikiTitle: "MusÃ©e_d%27art_cycladique",
        activity: "Idoles cycladiques + aile Stathatos."
      },

      // HORS VILLE
      { id: 10, name: "Cap Sounion", zone: "Hors Ville", color: "emerald", address: "Sounio 195 00", coords: [37.6502, 24.0245],
        hours: "09:30 - Coucher soleil", price: "Hiver: 5â‚¬", booking: "Non", myth: "Ã‰gÃ©e.", philo: "Nature.",
        website: "https://fr.wikipedia.org/wiki/Cap_Sounion", type: "Primaire",
        wikiTitle: "Cap_Sounion",
        activity: "Coucher de soleil derriÃ¨re les colonnes."
      },
      { id: 11, name: "Lac de Vouliagmeni", zone: "Hors Ville", color: "emerald", address: "Vouliagmeni 166 71", coords: [37.8073, 23.7854],
        hours: "08:00 - 17:00", price: "~16â‚¬", booking: "Non", myth: "Nymphes.", philo: "Soin.",
        website: "https://fr.wikipedia.org/wiki/Lac_de_VouliagmÃ©ni", type: "Primaire",
        wikiTitle: "Lac_de_VouliagmÃ©ni",
        activity: "Baignade thermale + cafÃ©."
      },
      { id: 19, name: "Centre Culturel SNFCC", zone: "Hors Ville", color: "emerald", address: "Leof. Syggrou 364", coords: [37.9402, 23.6923],
        hours: "06:00 - Minuit", price: "Gratuit", booking: "Pour l'OpÃ©ra", myth: "Moderne.", philo: "Espace Public.",
        website: "https://fr.wikipedia.org/wiki/Centre_culturel_de_la_fondation_StÃ¡vros_NiÃ¡rchos", type: "Secondaire",
        wikiTitle: "Centre_culturel_de_la_fondation_StÃ¡vros_NiÃ¡rchos",
        activity: "Lighthouse, canal, bibliothÃ¨que."
      },
      { id: 20, name: "Mont Lycabette", zone: "Hors Ville", color: "emerald", address: "Aristippou 1 (Funiculaire)", coords: [37.9820, 23.7432],
        hours: "24h/24", price: "Funiculaire ~7.50â‚¬", booking: "Non", myth: "Rocher d'AthÃ©na.", philo: "Hauteur.",
        website: "https://fr.wikipedia.org/wiki/Mont_Lycabette", type: "Secondaire",
        wikiTitle: "Mont_Lycabette",
        activity: "Vue panoramique au sommet."
      },
    ];

    // --- DONNÃ‰ES LIFESTYLE ---
    const lifestyleData = {
      hotels: [
        { name: "Herodion Hotel", type: "Confort / 4*", area: "Plaka / Acropole", price: "100â‚¬-120â‚¬", desc: "Ã‰lÃ©gant, calme, proche musÃ©e.", address: "Rovertou Galli 4" },
        { name: "Plaka Hotel", type: "Standard / 3*", area: "Plaka", price: "80â‚¬-100â‚¬", desc: "Vue toit-terrasse incroyable.", address: "Kapnikarea 7" },
        { name: "Home and Poetry", type: "Boutique", area: "Plaka", price: "90â‚¬", desc: "Charme nÃ©oclassique.", address: "Lysikratous 10" }
      ],
      restaurants: [
        { name: "Kuzina", type: "Moderne", price: "35â‚¬-50â‚¬", desc: "Vue temple HÃ©phaÃ¯stos.", address: "Adrianou 9" },
        { name: "To Kafeneio", type: "Taverne", price: "15â‚¬-25â‚¬", desc: "Authentique, bÃ¢timent 400 ans.", address: "Epicharmou 1" },
        { name: "Strofi", type: "Historique", price: "30â‚¬-45â‚¬", desc: "Vue ParthÃ©non depuis 1975.", address: "Rovertou Galli 25" },
        { name: "O Thanasis", type: "Street Food", price: "10â‚¬-15â‚¬", desc: "Gyros/kebab rÃ©putÃ© (Monastiraki).", address: "Mitropoleos 69" }
      ],
      activities: [
        { name: "Hammam Baths", type: "DÃ©tente", price: "45â‚¬", desc: "Bain traditionnel (Thissio).", address: "Melidoni 1" },
        { name: "SoirÃ©e Rebetiko", type: "Musique", price: "Repas", desc: "Blues grec en taverne.", address: "Ex: Klimataria" },
        { name: "CinÃ©mathÃ¨que", type: "Culture", price: "8â‚¬", desc: "CinÃ©ma en salle historique.", address: "Ex: Danaos" }
      ]
    };

    const photoChallenges = [
      { id: "p1", title: "L'Imposteur", desc: "Imite la pose d'une statue (Caryatide ou Kouros).", zone: "MusÃ©e / Acropole", icon: "ğŸ—¿" },
      { id: "p2", title: "Le Chat Socratique", desc: "Trouve un chat errant et demande-lui le sens de la vie.", zone: "Agora / Plaka", icon: "ğŸ±" },
      { id: "p3", title: "L'Orateur", desc: "Prends une pose de discours intense face au vide.", zone: "Pnyx", icon: "ğŸ“¢" },
      { id: "p4", title: "Le Gardien", desc: "Selfie Ã©pique avec le ParthÃ©non en arriÃ¨re-plan.", zone: "Acropole", icon: "ğŸ›ï¸" },
      { id: "p5", title: "Le Banquet", desc: "Photo artistique de ta meilleure salade grecque ou gyros.", zone: "Taverne", icon: "ğŸ¥—" },
      { id: "p6", title: "L'Horizon", desc: "Regard mÃ©lancolique vers la mer (style Ã‰gÃ©e).", zone: "Sounion / Areopage", icon: "ğŸŒŠ" }
    ];

    const zoneOrder = ["Acropole", "Agora", "Philosophie", "Hors Ville"];
    const colorToTailwind = { red: "red", blue: "blue", purple: "purple", emerald: "emerald" };
    const zoneTitle = (z) => z === "Acropole" ? "Le SacrÃ©" : z === "Agora" ? "La CitÃ©" : z === "Philosophie" ? "La Sagesse" : "La Nature";

    // --- Carte ---
    const MapComponent = ({ places, darkMode }) => {
      useEffect(() => {
        const container = L.DomUtil.get('map-container');
        if (container != null) container._leaflet_id = null;

        const map = L.map('map-container').setView([37.974, 23.73], 13);
        const lightTiles = 'https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png';
        const darkTiles  = 'https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png';
        L.tileLayer(darkMode ? darkTiles : lightTiles, { attribution: '&copy; OSM & CartoDB' }).addTo(map);

        places.forEach(place => {
          const color = place.color === 'red' ? '#dc2626'
                      : place.color === 'purple' ? '#7c3aed'
                      : place.color === 'emerald' ? '#10b981'
                      : '#3b82f6';
          const marker = L.circleMarker(place.coords, {
            color, fillColor: color, fillOpacity: 0.85,
            radius: place.type === 'Primaire' ? 10 : 6
          });
          marker.addTo(map).bindPopup(`<b>${place.name}</b><br/>${place.address}`);
        });

        return () => map.remove();
      }, [places, darkMode]);

      return <div id="map-container" className="shadow-xl border border-gray-200 dark:border-stone-700"></div>;
    };

    // --- Wikipedia thumbnails ---
    const WIKI_API = "https://fr.wikipedia.org/api/rest_v1/page/summary/";
    const wikiUrl = (title) => "https://fr.wikipedia.org/wiki/" + title;

    async function fetchWikiThumb(title) {
      const res = await fetch(WIKI_API + encodeURIComponent(title), { mode: "cors" });
      if (!res.ok) throw new Error("Wiki fetch failed");
      const data = await res.json();
      const thumb = data?.thumbnail?.source || "";
      const page = data?.content_urls?.desktop?.page || wikiUrl(title);
      return { thumb, page };
    }

    // --- PlaceCard ---
    const PlaceCard = ({ p, c, getMapsLink, wikiThumb }) => {
      const img = wikiThumb?.thumb || "";
      const wikiPage = wikiThumb?.page || wikiUrl(p.wikiTitle);

      return (
        <div className="bg-white dark:bg-stone-800 rounded-xl shadow-sm border border-gray-100 dark:border-stone-700 overflow-hidden flex flex-col">
          <div className="w-full h-48 overflow-hidden relative bg-gray-100 dark:bg-stone-900">
            {img ? (
              <img src={img} alt={p.name} className="w-full h-full object-cover" loading="lazy"/>
            ) : (
              <div className="w-full h-full img-skeleton"></div>
            )}

            <div className={"absolute bottom-0 left-0 w-full h-1 bg-" + c + "-500"}></div>

            <div className="absolute top-2 right-2">
              <a href={wikiPage} target="_blank" className="text-[11px] px-2 py-1 rounded bg-black/55 text-white hover:bg-black/70">
                Photo : Wikipedia
              </a>
            </div>
          </div>

          <div className="p-5 flex-grow flex flex-col">
            <div className="flex justify-between items-start gap-2 mb-2">
              <h4 className="font-bold text-slate-900 dark:text-slate-100 text-lg">{p.name}</h4>
              {p.type === 'Secondaire' && <span className="text-[10px] bg-gray-100 dark:bg-stone-700 text-gray-500 px-2 py-0.5 rounded">2nd</span>}
            </div>

            <div className="flex flex-wrap gap-3 mb-4 text-sm">
              <a href={getMapsLink(p)} target="_blank" className="text-blue-600 dark:text-blue-400 hover:underline">ğŸ“ {p.address}</a>
              <a href={p.website} target="_blank" className="text-gray-500 dark:text-gray-300 hover:underline">ğŸŒ Site</a>
            </div>

            <div className="bg-gray-50 dark:bg-stone-700 p-3 rounded-lg text-sm mb-4">
              <div className="font-semibold text-gray-800 dark:text-gray-200">ğŸ•’ {p.hours}</div>
              <div className="text-gray-600 dark:text-gray-300">ğŸŸï¸ {p.price}</div>
              {p.booking && <div className="text-gray-600 dark:text-gray-300">ğŸ“Œ {p.booking}</div>}
            </div>

            {p.activity && (
              <div className="mb-4">
                <span className="text-xs font-bold uppercase tracking-wide text-gray-500 dark:text-gray-300 mb-1 block">Ã€ faire :</span>
                <p className="text-sm text-gray-700 dark:text-gray-200 italic">â€œ{p.activity}â€</p>
              </div>
            )}

            <div className="space-y-2 text-sm mt-auto border-t border-gray-100 dark:border-stone-700 pt-3">
              <div className="text-amber-800 dark:text-amber-200 bg-amber-50 dark:bg-amber-900/30 p-2 rounded-lg">âš¡ <b>Mythe:</b> {p.myth}</div>
              <div className="text-sky-800 dark:text-sky-200 bg-sky-50 dark:bg-sky-900/30 p-2 rounded-lg">ğŸ§  <b>Philo:</b> {p.philo}</div>
            </div>
          </div>
        </div>
      );
    };

    // --- Planning (Agenda) ---
    const KIND = {
      flight:   { label:"Vol",       cls:"bg-blue-600" },
      train:    { label:"Train",     cls:"bg-teal-600" },
      transfer: { label:"Transfert", cls:"bg-purple-600" },
      hotel:    { label:"HÃ´tel",     cls:"bg-amber-600" },
      visit:    { label:"Visite",    cls:"bg-rose-600" },
      walk:     { label:"Balade",    cls:"bg-emerald-600" },
      food:     { label:"Repas",     cls:"bg-stone-700" },
      daytrip:  { label:"Excursion", cls:"bg-indigo-600" },
      note:     { label:"Note",      cls:"bg-gray-600" },
      alt:      { label:"Option",    cls:"bg-gray-600" },
    };

    const Modal = ({ children, onClose }) => (
      <div className="fixed inset-0 bg-black/55 z-[1000] flex items-center justify-center p-4"
           onClick={(e)=>{ if(e.target === e.currentTarget) onClose(); }}>
        <div className="w-full max-w-2xl bg-white dark:bg-stone-800 border border-gray-200 dark:border-stone-700 rounded-2xl overflow-hidden shadow-2xl">
          {children}
        </div>
      </div>
    );

    const EditItemModal = ({ activeDay, plan, setOverride, setDraft, onClose, item }) => {
      const [local, setLocal] = useState(item);

      const updatePlan = (mutator) => {
        const next = structuredClone(plan);
        mutator(next);
        setOverride(next);
        setDraft(JSON.stringify(next, null, 2));
      };

      const save = () => {
        updatePlan(next => {
          const di = next.days.findIndex(d => d.date === activeDay);
          const idx = next.days[di].items.findIndex(x => x.id === local.id);
          if (idx >= 0) next.days[di].items[idx] = local;
        });
        onClose();
      };

      const remove = () => {
        updatePlan(next => {
          const di = next.days.findIndex(d => d.date === activeDay);
          next.days[di].items = next.days[di].items.filter(x => x.id !== local.id);
        });
        onClose();
      };

      return (
        <>
          <div className="p-4 border-b border-gray-200 dark:border-stone-700 flex items-center justify-between">
            <div className="font-bold text-slate-900 dark:text-slate-100">Modifier</div>
            <button className="px-2 py-1 rounded bg-gray-100 dark:bg-stone-700" onClick={onClose}>âœ–</button>
          </div>

          <div className="p-4 grid md:grid-cols-2 gap-3">
            <div className="md:col-span-2">
              <label className="text-xs text-gray-500">Titre</label>
              <input className="w-full px-3 py-2 rounded-lg border border-gray-200 dark:border-stone-700 bg-white dark:bg-stone-900"
                     value={local.title}
                     onChange={(e)=>setLocal({...local, title:e.target.value})} />
            </div>

            <div>
              <label className="text-xs text-gray-500">Type</label>
              <select className="w-full px-3 py-2 rounded-lg border border-gray-200 dark:border-stone-700 bg-white dark:bg-stone-900"
                      value={local.kind}
                      onChange={(e)=>setLocal({...local, kind:e.target.value})}>
                {Object.keys(KIND).map(k => <option key={k} value={k}>{KIND[k].label}</option>)}
              </select>
            </div>

            <div>
              <label className="text-xs text-gray-500">Heures</label>
              <div className="flex gap-2">
                <input className="w-full px-3 py-2 rounded-lg border border-gray-200 dark:border-stone-700 bg-white dark:bg-stone-900"
                       placeholder="dÃ©but"
                       value={local.start || ""}
                       onChange={(e)=>setLocal({...local, start:e.target.value})} />
                <input className="w-full px-3 py-2 rounded-lg border border-gray-200 dark:border-stone-700 bg-white dark:bg-stone-900"
                       placeholder="fin (optionnel)"
                       value={local.end || ""}
                       onChange={(e)=>setLocal({...local, end:e.target.value})} />
              </div>
            </div>

            <div className="md:col-span-2">
              <label className="text-xs text-gray-500">DÃ©tails</label>
              <textarea className="w-full h-28 px-3 py-2 rounded-lg border border-gray-200 dark:border-stone-700 bg-white dark:bg-stone-900"
                        value={local.details || ""}
                        onChange={(e)=>setLocal({...local, details:e.target.value})} />
            </div>
          </div>

          <div className="p-4 border-t border-gray-200 dark:border-stone-700 flex justify-between">
            <button className="px-3 py-2 text-sm rounded-lg bg-red-600 text-white hover:bg-red-700" onClick={remove}>Supprimer</button>
            <div className="flex gap-2">
              <button className="px-3 py-2 text-sm rounded-lg bg-gray-100 dark:bg-stone-700" onClick={onClose}>Annuler</button>
              <button className="px-3 py-2 text-sm rounded-lg bg-emerald-600 text-white hover:bg-emerald-700" onClick={save}>Enregistrer</button>
            </div>
          </div>
        </>
      );
    };

    const PlanningTab = () => {
      const [filePlan, setFilePlan] = useState(null);
      const [override, setOverride] = useLocalStorageState("athens_plan_override_v3", null);
      const [activeDay, setActiveDay] = useState("");
      const [editing, setEditing] = useState(null); // item
      const [jsonEditor, setJsonEditor] = useState(false);
      const [draft, setDraft] = useState("");

      useEffect(() => {
        (async () => {
          const res = await fetch("./data/tripPlan.json", { cache: "no-store" });
          const data = await res.json();
          setFilePlan(data);
          const plan = override || data;
          setDraft(JSON.stringify(plan, null, 2));
          setActiveDay(plan.days?.[0]?.date || "");
        })().catch(()=>{});
      }, []);

      const plan = override || filePlan;
      if (!plan) return <div className="bg-white dark:bg-stone-800 border border-gray-200 dark:border-stone-700 rounded-xl p-5">Chargementâ€¦</div>;

      const exportJson = (obj, name) => {
        const blob = new Blob([JSON.stringify(obj, null, 2)], { type: "application/json;charset=utf-8" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = name;
        a.click();
        URL.revokeObjectURL(url);
      };

      const importJson = (file) => {
        if (!file) return;
        const r = new FileReader();
        r.onload = () => {
          try {
            const parsed = JSON.parse(String(r.result));
            setOverride(parsed);
            setDraft(JSON.stringify(parsed, null, 2));
            setActiveDay(parsed.days?.[0]?.date || "");
            alert("Planning importÃ© (surcharge locale).");
          } catch {
            alert("JSON invalide.");
          }
        };
        r.readAsText(file);
      };

      const reset = () => {
        setOverride(null);
        setDraft(JSON.stringify(filePlan, null, 2));
        setActiveDay(filePlan.days?.[0]?.date || "");
      };

      const day = (plan.days.find(d => d.date === activeDay) || plan.days[0]);

      const sortItems = (items) => {
        const key = (it) => (it.start || "99:99");
        return [...items].sort((a,b)=> key(a).localeCompare(key(b)));
      };

      const updatePlan = (mutator) => {
        const next = structuredClone(plan);
        mutator(next);
        setOverride(next);
        setDraft(JSON.stringify(next, null, 2));
      };

      const addItem = () => {
        updatePlan(next => {
          const di = next.days.findIndex(d => d.date === activeDay);
          const newItem = { id: "i_" + Math.random().toString(16).slice(2), kind:"visit", start:"10:00", end:"11:00", title:"Nouvel Ã©lÃ©ment", details:"" };
          next.days[di].items.push(newItem);
        });
      };

      return (
        <div className="animate-fade-in space-y-4">
          <div className="bg-white dark:bg-stone-800 border border-gray-200 dark:border-stone-700 rounded-xl overflow-hidden">
            <div className="p-5 flex flex-wrap items-center justify-between gap-3">
              <div>
                <div className="text-xl font-bold serif-title text-slate-900 dark:text-slate-100">ğŸ—“ï¸ Planning (Agenda)</div>
                <div className="text-sm text-gray-500">{plan.meta?.title || ""}</div>
              </div>
              <div className="flex flex-wrap gap-2">
                <button onClick={addItem} className="px-3 py-2 text-sm rounded-lg bg-emerald-600 text-white hover:bg-emerald-700">+ Ajouter</button>
                <button onClick={()=>exportJson(plan, "tripPlan.json")} className="px-3 py-2 text-sm rounded-lg bg-slate-900 text-white hover:bg-slate-800">Exporter</button>
                <label className="px-3 py-2 text-sm rounded-lg bg-slate-900 text-white hover:bg-slate-800 cursor-pointer">
                  Importer
                  <input type="file" accept="application/json" className="hidden" onChange={(e)=>importJson(e.target.files?.[0])}/>
                </label>
                <button onClick={()=>setJsonEditor(true)} className="px-3 py-2 text-sm rounded-lg bg-gray-100 dark:bg-stone-700 hover:bg-gray-200 dark:hover:bg-stone-600">Ã‰diter JSON</button>
                {override && <button onClick={reset} className="px-3 py-2 text-sm rounded-lg bg-red-600 text-white hover:bg-red-700">Reset</button>}
              </div>
            </div>

            <div className="px-5 pb-5">
              <div className="flex flex-wrap gap-2">
                {plan.days.map(d => (
                  <button
                    key={d.date}
                    onClick={()=>setActiveDay(d.date)}
                    className={"px-3 py-2 text-sm rounded-full border transition " + (activeDay===d.date
                      ? "bg-[#8c2f39] text-white border-[#8c2f39]"
                      : "bg-white dark:bg-stone-900 border-gray-200 dark:border-stone-700 hover:bg-gray-50 dark:hover:bg-stone-800")}
                  >
                    {d.label} â€¢ {d.date}
                  </button>
                ))}
              </div>
            </div>
          </div>

          <div className="grid lg:grid-cols-3 gap-4">
            <div className="lg:col-span-2 bg-white dark:bg-stone-800 border border-gray-200 dark:border-stone-700 rounded-xl overflow-hidden">
              <div className="p-5 flex items-center justify-between">
                <div className="font-bold text-slate-900 dark:text-slate-100">{day?.label} â€” {day?.date}</div>
                <div className="text-xs text-gray-500">Clique sur un item pour modifier</div>
              </div>

              <div className="px-5 pb-5 space-y-2">
                {sortItems(day?.items || []).map((it) => (
                  <button
                    key={it.id}
                    onClick={()=>setEditing(it)}
                    className="w-full text-left bg-gray-50 dark:bg-stone-900/40 border border-gray-200 dark:border-stone-700 rounded-xl p-4 hover:shadow-sm transition"
                  >
                    <div className="flex items-start justify-between gap-3">
                      <div className="min-w-0">
                        <div className="flex items-center gap-2">
                          <span className={"text-[11px] px-2 py-1 rounded-full text-white " + (KIND[it.kind]?.cls || "bg-gray-600")}>
                            {KIND[it.kind]?.label || it.kind}
                          </span>
                          <span className="text-sm text-gray-600 dark:text-gray-300">
                            {(it.start ? it.start : "â€”")} {it.end ? "â†’ " + it.end : ""}
                          </span>
                        </div>
                        <div className="font-bold text-slate-900 dark:text-slate-100 mt-1">{it.title}</div>
                        {it.details && <div className="text-sm text-gray-600 dark:text-gray-300 mt-1">{it.details}</div>}
                      </div>
                    </div>
                  </button>
                ))}
              </div>
            </div>

            <div className="space-y-4">
              <div className="bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-xl p-5">
                <div className="font-bold text-red-900 dark:text-red-200 mb-2">âš ï¸ Bagages</div>
                <ul className="list-disc pl-5 text-sm text-red-900/90 dark:text-red-200/90 space-y-1">
                  {(plan.essentials?.baggage || []).map((x,i)=><li key={i}>{x}</li>)}
                </ul>
              </div>

              <div className="bg-white dark:bg-stone-800 border border-gray-200 dark:border-stone-700 rounded-xl p-5">
                <div className="font-bold text-slate-900 dark:text-slate-100 mb-2">âœˆï¸ Vols</div>
                <div className="text-sm text-gray-700 dark:text-gray-200">
                  <div className="mb-2">
                    <b>Aller :</b> {plan.essentials?.flights?.outbound?.flight} â€” {plan.essentials?.flights?.outbound?.from} (T{plan.essentials?.flights?.outbound?.terminal})
                    <br/> {plan.essentials?.flights?.outbound?.depart} â†’ {plan.essentials?.flights?.outbound?.arrive} ({plan.essentials?.flights?.outbound?.to})
                  </div>
                  <div className="mb-2">
                    <b>Retour :</b> {plan.essentials?.flights?.inbound?.flight} â€” {plan.essentials?.flights?.inbound?.from}
                    <br/> {plan.essentials?.flights?.inbound?.depart} â†’ {plan.essentials?.flights?.inbound?.arrive} ({plan.essentials?.flights?.inbound?.to})
                  </div>
                  <div className="text-xs text-gray-500">{plan.essentials?.flights?.note}</div>
                </div>
              </div>

              <div className="bg-white dark:bg-stone-800 border border-gray-200 dark:border-stone-700 rounded-xl p-5">
                <div className="font-bold text-slate-900 dark:text-slate-100 mb-2">ğŸ’¶ Budget</div>
                <ul className="list-disc pl-5 text-sm text-gray-700 dark:text-gray-200 space-y-1">
                  {(plan.essentials?.money || []).map((x,i)=><li key={i}>{x}</li>)}
                </ul>
              </div>

              <div className="bg-white dark:bg-stone-800 border border-gray-200 dark:border-stone-700 rounded-xl p-5">
                <div className="font-bold text-slate-900 dark:text-slate-100 mb-2">ğŸ¨ HÃ´tel & transferts</div>
                <ul className="list-disc pl-5 text-sm text-gray-700 dark:text-gray-200 space-y-1">
                  {(plan.essentials?.hotel || []).map((x,i)=><li key={i}>{x}</li>)}
                  {(plan.essentials?.transfers || []).map((x,i)=><li key={"t"+i}>{x}</li>)}
                </ul>
              </div>

              <div className="bg-white dark:bg-stone-800 border border-gray-200 dark:border-stone-700 rounded-xl p-5">
                <div className="font-bold text-slate-900 dark:text-slate-100 mb-2">ğŸšª Door-to-door</div>
                <ul className="list-disc pl-5 text-sm text-gray-700 dark:text-gray-200 space-y-1">
                  {(plan.essentials?.doorToDoor || []).map((x,i)=><li key={i}>{x}</li>)}
                </ul>
              </div>
            </div>
          </div>

          {editing && (
            <Modal onClose={()=>setEditing(null)}>
              <EditItemModal
                activeDay={activeDay}
                plan={plan}
                setOverride={setOverride}
                setDraft={setDraft}
                onClose={()=>setEditing(null)}
                item={editing}
              />
            </Modal>
          )}

          {jsonEditor && (
            <Modal onClose={()=>setJsonEditor(false)}>
              <div className="p-4 border-b border-gray-200 dark:border-stone-700 flex items-center justify-between">
                <div className="font-bold text-slate-900 dark:text-slate-100">Ã‰dition JSON (surcharge locale)</div>
                <button className="px-2 py-1 rounded bg-gray-100 dark:bg-stone-700" onClick={()=>setJsonEditor(false)}>âœ–</button>
              </div>
              <div className="p-4">
                <div className="text-xs text-gray-500 mb-2">
                  Pour partager : Exporter â†’ remplacer <code>data/tripPlan.json</code> â†’ commit/push.
                </div>
                <textarea className="w-full h-80 font-mono text-xs p-3 rounded-lg border border-gray-200 dark:border-stone-700 bg-white dark:bg-stone-900"
                          value={draft}
                          onChange={(e)=>setDraft(e.target.value)}></textarea>
              </div>
              <div className="p-4 border-t border-gray-200 dark:border-stone-700 flex justify-end gap-2">
                <button className="px-3 py-2 text-sm rounded-lg bg-gray-100 dark:bg-stone-700" onClick={()=>setJsonEditor(false)}>Annuler</button>
                <button className="px-3 py-2 text-sm rounded-lg bg-emerald-600 text-white" onClick={()=>{
                  try {
                    const parsed = JSON.parse(draft);
                    setOverride(parsed);
                    setJsonEditor(false);
                    alert("JSON appliquÃ© (surcharge locale).");
                  } catch (e) {
                    alert("JSON invalide : " + (e.message || e));
                  }
                }}>Appliquer</button>
              </div>
            </Modal>
          )}
        </div>
      );
    };

    // --- Lifestyle tab ---
    const LifestyleTab = () => (
      <div className="animate-fade-in grid gap-12">
        <section>
          <h3 className="text-2xl font-bold serif-title text-slate-800 dark:text-slate-200 mb-6">ğŸ›ï¸ HÃ´tels (Janvier)</h3>
          <div className="grid md:grid-cols-3 gap-6">
            {lifestyleData.hotels.map((h, i) => (
              <div key={i} className="bg-white dark:bg-stone-800 p-6 rounded-xl border border-gray-100 dark:border-stone-700 shadow-sm">
                <div className="flex justify-between items-start mb-2">
                  <h4 className="font-bold text-lg text-slate-900 dark:text-slate-100">{h.name}</h4>
                  <span className="text-xs bg-gray-100 dark:bg-stone-700 dark:text-gray-300 px-2 py-1 rounded">{h.type}</span>
                </div>
                <p className="text-sm text-gray-600 dark:text-gray-300 mb-2">{h.desc}</p>
                <p className="text-sm font-bold text-slate-800 dark:text-slate-200">{h.price}</p>
                <a href={`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(h.address + ' ' + h.name + ' Athens')}`} target="_blank" className="text-xs text-blue-600 dark:text-blue-400 mt-2 block hover:underline">ğŸ“ {h.address}</a>
              </div>
            ))}
          </div>
        </section>

        <section>
          <h3 className="text-2xl font-bold serif-title text-slate-800 dark:text-slate-200 mb-6">ğŸ½ï¸ Restaurants & Tavernes</h3>
          <div className="grid md:grid-cols-2 lg:grid-cols-4 gap-6">
            {lifestyleData.restaurants.map((r, i) => (
              <div key={i} className="bg-white dark:bg-stone-800 p-6 rounded-xl border border-gray-100 dark:border-stone-700 shadow-sm">
                <h4 className="font-bold text-lg mb-1 text-slate-900 dark:text-slate-100">{r.name}</h4>
                <p className="text-xs text-amber-700 dark:text-amber-500 font-bold mb-2">{r.type}</p>
                <p className="text-sm text-gray-600 dark:text-gray-300 mb-2">{r.desc}</p>
                <p className="text-sm font-bold text-slate-800 dark:text-slate-200">{r.price}</p>
                <a href={`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(r.address + ' ' + r.name + ' Athens')}`} target="_blank" className="text-xs text-blue-600 dark:text-blue-400 mt-2 block hover:underline">ğŸ“ {r.address}</a>
              </div>
            ))}
          </div>
        </section>

        <section>
          <h3 className="text-2xl font-bold serif-title text-slate-800 dark:text-slate-200 mb-6">ğŸ­ ActivitÃ©s & DÃ©tente</h3>
          <div className="grid md:grid-cols-2 gap-6">
            {lifestyleData.activities.map((a, i) => (
              <div key={i} className="bg-stone-50 dark:bg-stone-800 p-6 rounded-xl border border-gray-100 dark:border-stone-700">
                <div className="flex justify-between mb-1">
                  <h4 className="font-bold text-lg text-slate-900 dark:text-slate-100">{a.name}</h4>
                  <span className="text-sm font-bold text-slate-700 dark:text-slate-300">{a.price}</span>
                </div>
                <p className="text-sm text-gray-700 dark:text-gray-300">{a.desc}</p>
                <a href={`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(a.address + ' ' + a.name + ' Athens')}`} target="_blank" className="text-xs text-blue-600 dark:text-blue-400 mt-2 block hover:underline">ğŸ“ {a.address}</a>
              </div>
            ))}
          </div>
        </section>
      </div>
    );

    // --- Photo Bingo tab ---
    const PhotosTab = () => {
      const [userPhotos, setUserPhotos] = useLocalStorageState("athens_bingo_photos_v3", {}); // {id:dataURL}

      const handleUpload = (challengeId, file) => {
        if (!file) return;
        const r = new FileReader();
        r.onload = () => {
          const url = String(r.result || "");
          setUserPhotos(prev => ({ ...prev, [challengeId]: url }));
        };
        r.readAsDataURL(file);
      };

      const clearAll = () => setUserPhotos({});

      return (
        <div className="animate-fade-in">
          <div className="text-center mb-6 bg-yellow-50 dark:bg-yellow-900/20 p-6 rounded-xl border border-yellow-200 dark:border-yellow-800">
            <h3 className="text-2xl font-bold serif-title text-yellow-800 dark:text-yellow-500 mb-2">ğŸ“¸ Le Bingo de l'OdyssÃ©e</h3>
            <p className="text-gray-700 dark:text-gray-300">6 missions photos. Stockage local dans le navigateur.</p>
            <button onClick={clearAll} className="mt-4 px-3 py-2 text-sm rounded-lg bg-red-600 text-white hover:bg-red-700">
              Effacer toutes les photos
            </button>
          </div>

          <div className="grid grid-cols-2 md:grid-cols-3 gap-4 md:gap-8">
            {photoChallenges.map(chal => (
              <label key={chal.id} className="cursor-pointer group relative">
                <input
                  type="file"
                  accept="image/*"
                  className="hidden"
                  onChange={(e) => handleUpload(chal.id, e.target.files?.[0])}
                />

                <div className={"rounded-2xl border-4 shadow-md flex flex-col items-center justify-center p-4 text-center overflow-hidden relative bg-white dark:bg-stone-800 " + (userPhotos[chal.id]
                  ? "border-green-500"
                  : "border-dashed border-gray-300 dark:border-stone-600 hover:border-blue-400 hover:bg-blue-50 dark:hover:bg-stone-700")}>
                  <div className="aspect-square w-full flex items-center justify-center relative">
                    {userPhotos[chal.id] ? (
                      <>
                        <img src={userPhotos[chal.id]} className="absolute inset-0 w-full h-full object-cover opacity-95" />
                        <div className="absolute bottom-0 left-0 right-0 bg-black/60 text-white p-2 text-xs font-bold">
                          âœ… {chal.title}
                        </div>
                      </>
                    ) : (
                      <div className="w-full">
                        <div className="text-4xl mb-2">{chal.icon}</div>
                        <h4 className="font-bold text-slate-800 dark:text-slate-200 mb-1">{chal.title}</h4>
                        <p className="text-xs text-gray-500 dark:text-gray-300 leading-tight">{chal.desc}</p>
                        <div className="mt-4 px-3 py-1 bg-gray-100 dark:bg-stone-700 rounded-full text-xs text-gray-500 group-hover:bg-blue-200 group-hover:text-blue-800 transition-colors inline-block">
                          Clique pour ajouter
                        </div>
                      </div>
                    )}
                  </div>
                </div>
              </label>
            ))}
          </div>
        </div>
      );
    };

    // --- App ---
    const App = () => {
      const [activeTab, setActiveTab] = useLocalStorageState("athens_tab_v3", "zones");
      const [darkMode, setDarkMode] = useLocalStorageState("athens_dark_v3", false);
      const [query, setQuery] = useState("");
      const [thumbs, setThumbs] = useState({}); // {placeId: {thumb,page}}

      useEffect(() => {
        if (darkMode) document.documentElement.classList.add("dark");
        else document.documentElement.classList.remove("dark");
      }, [darkMode]);

      const getMapsLink = (place) => {
        const q = encodeURIComponent(`${place.address} ${place.name} Athens`);
        return `https://www.google.com/maps/search/?api=1&query=${q}`;
      };

      useEffect(() => {
        let cancelled = false;
        (async () => {
          for (const p of placesData) {
            if (!p.wikiTitle) continue;
            if (thumbs[p.id]) continue;
            try {
              const info = await fetchWikiThumb(p.wikiTitle);
              if (cancelled) return;
              setThumbs(prev => ({ ...prev, [p.id]: info }));
            } catch {
              // ignore
            }
          }
        })();
        return () => { cancelled = true; };
      }, []);

      const filteredPlaces = useMemo(() => {
        const q = query.trim().toLowerCase();
        return placesData.filter(p => !q || (p.name + " " + p.zone + " " + p.address).toLowerCase().includes(q));
      }, [query]);

      const grouped = useMemo(() => {
        const acc = {};
        for (const p of filteredPlaces) (acc[p.zone] = acc[p.zone] || []).push(p);
        return acc;
      }, [filteredPlaces]);

      return (
        <div className="max-w-6xl mx-auto p-4 md:p-8 min-h-screen">
          <div className="flex items-center justify-between gap-3 mb-4">
            <div className="text-xs text-gray-500 dark:text-gray-400">GitHub Pages â€¢ Photos via Wikipedia â€¢ Planning + Carte + DÃ©fi photo</div>
            <button
              onClick={() => setDarkMode(!darkMode)}
              className="p-2 rounded-full bg-gray-200 dark:bg-stone-700 text-gray-800 dark:text-gray-200 hover:bg-gray-300 dark:hover:bg-stone-600 transition-colors text-sm font-bold"
            >
              {darkMode ? "â˜€ï¸ Mode Jour" : "ğŸŒ™ Mode Nuit"}
            </button>
          </div>

          <header className="mb-8">
            <div className="bg-white dark:bg-stone-800 border border-gray-200 dark:border-stone-700 rounded-2xl p-6 md:p-8">
              <div className="flex flex-col md:flex-row md:items-end md:justify-between gap-4">
                <div>
                  <h1 className="text-4xl md:text-6xl text-slate-900 dark:text-slate-100 tracking-tight">AthÃ¨nes</h1>
                  <h2 className="text-lg md:text-2xl text-slate-600 dark:text-slate-300 italic font-light font-serif">Guide Ultime â€” Hiver</h2>
                  <div className="mt-3 inline-flex items-center gap-2 px-4 py-1 bg-blue-50 dark:bg-blue-900/30 text-blue-800 dark:text-blue-300 rounded-full text-sm border border-blue-100 dark:border-blue-800">
                    <span>â›… Janvier :</span><span className="font-bold">10Â°C - 15Â°C</span>
                  </div>
                </div>

                <div className="w-full md:w-[360px]">
                  <div className="text-xs text-gray-500 mb-1">Recherche lieux</div>
                  <input
                    value={query}
                    onChange={(e)=>setQuery(e.target.value)}
                    placeholder="Acropole, Agora, musÃ©e..."
                    className="w-full px-3 py-2 rounded-lg border border-gray-200 dark:border-stone-700 bg-white dark:bg-stone-900"
                  />
                </div>
              </div>
            </div>
          </header>

          <nav className="flex flex-wrap justify-center gap-2 md:gap-6 mb-8 border-b border-gray-200 dark:border-stone-700 sticky top-0 bg-[#f4f1ea] dark:bg-stone-900 z-20 py-2">
            {[
              { id: "zones", label: "ğŸ›ï¸ Lieux" },
              { id: "planning", label: "ğŸ—“ï¸ Planning" },
              { id: "map", label: "ğŸ—ºï¸ Carte" },
              { id: "lifestyle", label: "ğŸ· Vie pratique" },
              { id: "photos", label: "ğŸ“¸ DÃ©fi photo" },
            ].map(tab => (
              <button
                key={tab.id}
                onClick={() => setActiveTab(tab.id)}
                className={"px-4 py-2 rounded-full text-sm md:text-base transition-all " + (activeTab===tab.id
                  ? "bg-[#8c2f39] text-white shadow-lg"
                  : "text-gray-600 dark:text-gray-300 hover:bg-white dark:hover:bg-stone-800")}
              >
                {tab.label}
              </button>
            ))}
          </nav>

          {activeTab === "zones" && (
            <div className="animate-fade-in space-y-10">
              {zoneOrder.map(zone => {
                const places = grouped[zone] || [];
                if (!places.length) return null;
                const c = colorToTailwind[places[0].color] || "blue";

                const primaries = places.filter(p => p.type === "Primaire");
                const secondaries = places.filter(p => p.type === "Secondaire");

                return (
                  <section key={zone}>
                    <h3 className={"text-2xl font-bold serif-title mb-5 pb-2 border-b-2 border-" + c + "-600 text-" + c + "-900 dark:text-" + c + "-300"}>
                      {zoneTitle(zone)}
                    </h3>

                    <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                      {primaries.map(p => (
                        <PlaceCard key={p.id} p={p} c={c} getMapsLink={getMapsLink} wikiThumb={thumbs[p.id]} />
                      ))}
                      {secondaries.map(p => (
                        <PlaceCard key={p.id} p={p} c={c} getMapsLink={getMapsLink} wikiThumb={thumbs[p.id]} />
                      ))}
                    </div>
                  </section>
                );
              })}
            </div>
          )}

          {activeTab === "planning" && <PlanningTab />}

          {activeTab === "map" && (
            <div className="animate-fade-in bg-white dark:bg-stone-800 p-4 rounded-xl shadow-sm border border-gray-200 dark:border-stone-700">
              <MapComponent places={placesData} darkMode={darkMode} />
              <p className="text-center text-gray-500 text-sm mt-4">Carte : sites majeurs et secondaires.</p>
            </div>
          )}

          {activeTab === "lifestyle" && <LifestyleTab />}

          {activeTab === "photos" && <PhotosTab />}

          <footer className="mt-16 text-center text-gray-400 text-sm pb-8 border-t border-gray-200 dark:border-stone-700 pt-8">
            Guide AthÃ¨nes â€¢ Photos via Wikipedia â€¢ Planning â€¢ Carte â€¢ Vie pratique â€¢ DÃ©fi photo
          </footer>
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById("root"));
    root.render(<App />);
  </script>
</body>
</html>
